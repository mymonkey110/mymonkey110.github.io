
 <!DOCTYPE HTML>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
  
    <title>Michael-J</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Michael Jiang">
    

    
    <meta property="og:type" content="website">
<meta property="og:title" content="Michael-J">
<meta property="og:url" content="http://michael-j.net/page/3/index.html">
<meta property="og:site_name" content="Michael-J">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Michael-J">

    
    <link rel="alternative" href="/atom.xml" title="Michael-J" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="Michael-J" title="Michael-J"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Michael-J">Michael-J</a></h1>
				<h2 class="blog-motto">一个修行路上的码农</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:michael-j.net">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/09/18/DDD-复杂问题解决之道/" title="DDD-复杂问题解决之道" itemprop="url">DDD-复杂问题解决之道</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Michael Jiang" target="_blank" itemprop="author">Michael Jiang</a>
		
  <p class="article-time">
    <time datetime="2016-09-18T14:09:45.000Z" itemprop="datePublished"> Published 2016-09-18</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>上个星期在团队内部进行了关于DDD的分享，分享链接：<a href="http://slides.com/michael-j/ddd-tackling-complex-problem#/" target="_blank" rel="noopener">http://slides.com/michael-j/ddd-tackling-complex-problem#/</a>。</p>
<p>分享的过程中发现还是有很多小伙伴对DDD不太了解，或者一知半解。DDD其实不是一个新的技术，实际上距离Eric Evans出版《Domain Driven Design》已经12年了。与其说DDD是一门编程技术，我更愿意将它称之为软件开发方法。我发现国内的技术分享两级分化比较严重，要么太过高大上——关于架构、新技术之类，要么太底层——关于数据库优化、底层性能优化之类，但很少有人来讲中间的那一层——软件编程方法。</p>
<p>在我看来，一个新人要成长为技术大牛，都要经历下面三个阶段：</p>
<h3 id="1-Make-It-Work-（1-2-年）"><a href="#1-Make-It-Work-（1-2-年）" class="headerlink" title="1. Make It Work （1~2 年）"></a>1. Make It Work （1~2 年）</h3><p>刚刚踏入职场的新手程序员往往处于这个阶段，他们首要的工作是要让系统能正常工作。出于工作的需要，他们开始了解语言、框架、数据库、缓存。如果在大公司的话，可能会更早的接触服务框架、中间件等。但是他们的主要工作还是实现业务需求，对代码的质量没有过多的要求。有时候可能感觉到现在的写法可能不太好，但是又不知道怎么去组织代码才能让它们看上去更舒服，经常会刚到迷茫，好像刚工作一年就看到了未来十年的影子，这是十分令人沮丧的。这个阶段一般会持续1~2年。</p>
<h3 id="2-Write-better-code-3-5-年"><a href="#2-Write-better-code-3-5-年" class="headerlink" title="2. Write better code (3~5 年)"></a>2. Write better code (3~5 年)</h3><p>这个阶段是新手程序员向老司机转变的一个时机。他们已经能独立完成常见的业务需求，并给出自己的意见。写出的代码不仅是为了完成功能，更多地是在寻找一种平衡的美。这种美很难言明，它是介于现实逻辑和代码组织的一种完美结合。正好我也处于这个阶段，我会有时因为一次完美的解耦而欣喜，也会因为业务的妥协而忧伤。在这个时期，我在寻找一种“术”，一种能随心所欲驾驭代码的术。我开始了解到OO技术的精妙，开始理解设计模式的妙用，学着掌控整个项目的发展，只为达到软件的最高境界——“可复用”。这个阶段肯能持续时间很长，因为我们要细细去品味优秀代码的味道并为己所用，这需要时间的沉淀。</p>
<h3 id="3-Create-suitable-architect-5年"><a href="#3-Create-suitable-architect-5年" class="headerlink" title="3. Create suitable architect (5年 ~ )"></a>3. Create suitable architect (5年 ~ )</h3><p>当你能随心所欲的操纵代码时，你就会去寻找你还未涉及的阶段。这个阶段可能会产生多种分化，你可能会对项目的整体架构产生兴趣而走上架构师的道路，也可能对某些专有技术情有独钟而成为某一方面的技术专家。不论后面的发展方向如何，此时代码对你已经不是问题了，而成为了你的“工具”。国内的技术分享往往也集中在这个层面。好的架构往往有着相似的部分，但是每个架构又有它独有的业务背景，你需要剥离其中的业务部分，找出能为自己的项目有用的设计。没有完美的架构，只有最合适的架构，任何现实的架构都充满着妥协和折中。这个阶段持续时间可能更长，你也需要机缘能参与几个重大项目的架构设计。</p>
<p>说白了，软件开发还是一门需要经验的行业。我并不太相信天才的存在，因为没有长时间浸泡在代码之中项目之中，你是很难理解代码和业务的关系的，这需要大量的时间。现在“新技术”层出不穷，我的建议是，在没有成为真正的架构师之前，不要盲目的追逐这些“新技术”，这只会耗费你大量的精力。</p>
<p>言归正传，我认为DDD是一门教你Write better code的软件开发方法。就算你是底层的研发人员，我相信你也会从中收益。如果你是一名业务程序员（80%的都是），为什么不多花一些时间去真正理解你的业务呢？不要再去追逐那些“新技术”，多去思考一下我的代码该如何解耦、业务如何切分、代码怎么写才能更好的复用。如果你坚持这么做，我相信不出两年你对技术和业务的理解会发生质变。</p>
<p>学习DDD其实还是有一定的曲线的，如果你的团队中已经有人尝试过DDD了不妨向他取经，因为DDD的精髓更多的在于编程的思想，而不在于具体的代码。后期我会分享一些关于DDD、OO、Microservice方面的心得，如果你有这方面的心得和困惑也可以与我交流，分享是技术人成长的很重要的途径。</p>
<p>近期，我换了工作，加入了网易蜂巢团队。以前上研究生的时候就搞云计算，想不到时隔两年之后，又加入了云计算的浪潮之中，也算是殊途同归。</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/DDD/">DDD</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/DDD/">DDD</a><a href="/tags/感悟/">感悟</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/08/02/Zookeeper-distributed-process-coordination/" title="Zookeeper:distributed process coordination中文版" itemprop="url">Zookeeper:distributed process coordination中文版</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Michael Jiang" target="_blank" itemprop="author">Michael Jiang</a>
		
  <p class="article-time">
    <time datetime="2016-08-02T08:53:05.000Z" itemprop="datePublished"> Published 2016-08-02</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>最近使用zookeeper比较多，但是国内关于zookeeper方面的数据太少。能介绍其使用同时也讲解原理的书太少了。Zookeeper:distributed process coordination是一本关于zookeeper不可多得的好书。读完以后我对zookeeper有能一个非常直观的了解。</p>
<p>现在分布式应用开发越来越常见，基本上大部分的分布式应用都需要与其它应用进行协同。Zookeeper非常擅长于处理分布式协同。所以我决定利用工作之余的时间翻译这本书籍，完全出于个人兴趣。</p>
<p><img src="/images/zookeeper/zookeeper.jpg" alt="zookeeper:distributed process coordination"></p>
<p><a href="https://www.gitbook.com/book/mymonkey110/zookeeper-distributed-process-coordination" target="_blank" rel="noopener">GitBook阅读地址</a></p>
<p><a href="https://github.com/mymonkey110/zookeeper-book/blob/master/SUMMARY.md" target="_blank" rel="noopener">GitHub阅读地址</a></p>
<p>由于本人第一次翻译技术书籍，肯定会有很多翻译不当的地方，欢迎大家能及时指正。如果有对本书翻译有兴趣的小伙伴，可以通过以下方式参与贡献：</p>
<p>参与讨论：邮件列表：<a href="mailto:&#122;&#x6b;&#x5f;&#116;&#114;&#97;&#110;&#x73;&#108;&#x61;&#116;&#x6f;&#x72;&#x40;&#103;&#114;&#x6f;&#117;&#x70;&#x73;&#46;&#x31;&#54;&#x33;&#46;&#99;&#111;&#109;" target="_blank" rel="noopener">&#122;&#x6b;&#x5f;&#116;&#114;&#97;&#110;&#x73;&#108;&#x61;&#116;&#x6f;&#x72;&#x40;&#103;&#114;&#x6f;&#117;&#x70;&#x73;&#46;&#x31;&#54;&#x33;&#46;&#99;&#111;&#109;</a>，申请加入地址：<a href="http://163.fm/UJNWGHS" target="_blank" rel="noopener">http://163.fm/UJNWGHS</a></p>
<p>部分贡献：通过issue进行讨论，如果通过，我会进行修改。这种方式我无法统计贡献者的名字，建议使用下面的方式参与翻译。</p>
<p>在 GitHub 上 fork 到自己的仓库，如 user/zookeeper-book，然后 clone 到本地，并设置用户信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git clone git@github.com:user/zookeeper-book.git</span><br><span class="line">$ cd zookeeper-book</span><br><span class="line">$ git config user.name &quot;yourname&quot;</span><br><span class="line">$ git config user.email &quot;your email&quot;</span><br></pre></td></tr></table></figure>
<p>修改代码后提交，并推送到自己的仓库。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ #do some change on the content</span><br><span class="line">$ git commit -am &quot;Fix issue #1: change helo to hello&quot;</span><br><span class="line">$ git push</span><br></pre></td></tr></table></figure>
<p>在 GitHub 网站上提交 pull request。<br>定期使用项目仓库内容更新自己仓库内容。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git remote add upstream https://github.com/mymonkey110/zookeeper-book.git</span><br><span class="line">$ git fetch upstream</span><br><span class="line">$ git checkout master</span><br><span class="line">$ git rebase upstream/master</span><br><span class="line">$ git push -f origin master</span><br></pre></td></tr></table></figure>
<p>PS: 2016/8/15 Update:</p>
<p>很遗憾，因为授权的问题，不得不停止翻译的工作。本书已经有中文版的译本了，我后来才得知，所以我也不会取得中文版的翻译授权了。因为本人第一次翻译，事先没有搞清这些事情，才导致了现在的情况。不得不说，十分遗憾，感谢关注本书翻译的伙伴。我相信已有的中文译本应该还不错，如果需要的伙伴可以去购买。So, that’s it, it’s over, thanks for your attention.</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/翻译/">翻译</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/zookeeper/">zookeeper</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/06/23/让百度索引你的github的博客/" title="让百度索引你的github的博客" itemprop="url">让百度索引你的github的博客</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Michael Jiang" target="_blank" itemprop="author">Michael Jiang</a>
		
  <p class="article-time">
    <time datetime="2016-06-23T08:53:05.000Z" itemprop="datePublished"> Published 2016-06-23</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>不知不觉中，写博客是一件很潮的事情，尤其是程序员。自然，我也是其中的一员。博客无非两种类型，一种是动态类型的，以Wordpress为代表；另外一种则是存静态的，以Hexo, Jekyll为代表。现在，程序员都喜欢把博客托管在github上。一来省去了买虚拟主机的费用，二来可以通过git工具来管理博客，用起来十分方便。我的博客就是用hexo搭建的。</p>
<p>首先，github是不支持动态博客的，它只能托管存静态的网页，也就是说你只能放置一些html,js,css,jpg,png…之类的静态文件。其次，github屏蔽了百度的爬虫，也就是说百度不能索引你的博客内容。虽说程序员基本上都用google，但是你肯定还是想能被百度搜索到的。想知道自己的博客是否被索引可以这样查询，在搜索引擎中输入：site: 你的博客域名。</p>
<p>解决github屏蔽百度爬虫的思路就是“迁出”我们的博客，让百度爬虫不直接访问github就行了。</p>
<h2 id="方案一：利用CDN制作镜像网站"><a href="#方案一：利用CDN制作镜像网站" class="headerlink" title="方案一：利用CDN制作镜像网站"></a>方案一：利用CDN制作镜像网站</h2><p>我们知道cdn能缓存静态资源，如果我们利用cdn制作我们的镜像网站，再将百度索引的解析cdn上，那么爬虫就不会访问github服务器了，而是访问cdn缓存服务器。国内最火的cdn服务商就是七牛和又拍云了。我发现七牛不支持自动回源功能，而又拍云在这方面做得比较好，我们可以使用又拍云来做为我们博客的镜像网站。</p>
<p>我以本站为例，讲一下配置的流程：</p>
<h4 id="1-创建服务"><a href="#1-创建服务" class="headerlink" title="1. 创建服务"></a>1. 创建服务</h4><p>   <img src="/images/baidu_index/3.pic_hd.jpg" alt="创建服务"></p>
<h4 id="2-配置回源"><a href="#2-配置回源" class="headerlink" title="2. 配置回源"></a>2. 配置回源</h4><p>   <img src="/images/baidu_index/5.pic_hd.jpg" alt="配置回源"></p>
<h4 id="3-绑定域名"><a href="#3-绑定域名" class="headerlink" title="3. 绑定域名"></a>3. 绑定域名</h4><p>完成上面的操作后，又拍云会自动分配一个域名给我。此时，我们就需要绑定自己的域名。添加需要绑定的域名：</p>
<p>   <img src="/images/baidu_index/5.pic.jpg" alt="绑定域名"></p>
<p>如果你希望博客能以www的方式来访问，那你还需要添加www的二级域名</p>
<h4 id="4-配置解析"><a href="#4-配置解析" class="headerlink" title="4. 配置解析"></a>4. 配置解析</h4><p>添加完域名绑定后，此时我们就只需要配置dns解析到又拍云了。我使用的是阿里云的域名系统，下图就是我设置的域名解析配置。</p>
<p>   <img src="/images/baidu_index/6.pic_hd.jpg" alt="配置解析"></p>
<p>因为github在国外访问速度还是很快的，所以对于海外的用户直接访问github就可以了，不用再访问又拍云了。<br>添加解析后一般需要几分钟才生效，看自己添加的域名dns解析生效了没有可以使用nslookup命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">~/blog  ᐅ nslookup michael-j.net</span><br><span class="line">Server:		192.168.199.2</span><br><span class="line">Address:	192.168.199.2#53</span><br><span class="line"></span><br><span class="line">Non-authoritative answer:</span><br><span class="line">michael-j.net	canonical name = mj-blog.b0.aicdn.com.</span><br><span class="line">mj-blog.b0.aicdn.com	canonical name = ctn.b9.aicdn.com.</span><br><span class="line">Name:	ctn.b9.aicdn.com</span><br><span class="line">Address: 183.134.101.194</span><br></pre></td></tr></table></figure>
<p>  此时，我发现michael-j.net的域名已经成功解析到了又拍云。</p>
<ol start="5">
<li>完成</li>
</ol>
<p>完成以上步骤后，你会收到又拍云发给你关于域名绑定通过的邮件。此时你就可以在浏览器中访问你的博客啦！</p>
<p>最关键的问题是，我们要验证百度是否能正常的抓取我们的博客？ 我们使用百度站长的测试工具来测试一下：</p>
<p>  <img src="/images/baidu_index/7.pic_hd.jpg" alt="抓取诊断"></p>
<p>哈哈，现在百度终于可以正常爬去我们的网站啦，接下来就是耐心的等待了，一般最多七天百度就会收录了。</p>
<h2 id="方案二：自己托管博客"><a href="#方案二：自己托管博客" class="headerlink" title="方案二：自己托管博客"></a>方案二：自己托管博客</h2><p>与利用cdn来制作镜像网站的思路一样，我们完全可以把博客托管在自己的服务器上，当然你得掏银子啦！💰 我个人觉得自己买一台属于自己的虚拟主机还是值得投入了，除了博客外你可以利用这台机器做很多事情，最低配的ecs也花不了多少钱，可以几个人合用一台。</p>
<p>Nginx是世界有名的反向代理服务器，同时它对静态文件的支持非常好，性能很高。我们完全可以利用Nginx来作我们博客的服务器。</p>
<h4 id="1-安装Nginx"><a href="#1-安装Nginx" class="headerlink" title="1. 安装Nginx"></a>1. 安装Nginx</h4><p>Ubuntu\Debian：<code>apt-get install nginx</code></p>
<p>Centos\Redhat: <code>yum install nginx</code></p>
<p>其他系统自行google</p>
<h4 id="2-配置Nginx"><a href="#2-配置Nginx" class="headerlink" title="2. 配置Nginx"></a>2. 配置Nginx</h4><p>在/etc/nginx/conf.d新作配置，一定要以<code>.conf</code>结尾。我新建名为<code>michael-j.net.conf</code>的配置文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">   	listen 80;</span><br><span class="line">   	server_name michael-j.net;</span><br><span class="line"></span><br><span class="line">   	location / &#123;</span><br><span class="line">   	  root /home/michael/mymonkey110.github.io;</span><br><span class="line">   	  index index.html;</span><br><span class="line">   	&#125;</span><br><span class="line"></span><br><span class="line">   	access_log /var/log/nginx/michael-j.access.log;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意root是我们博客的目录，后面会提到。</p>
<h4 id="3-重启nginx"><a href="#3-重启nginx" class="headerlink" title="3. 重启nginx"></a>3. 重启nginx</h4><p>执行<code>nginx -s reload</code>生效</p>
<h4 id="4-自动下载博客内容"><a href="#4-自动下载博客内容" class="headerlink" title="4. 自动下载博客内容"></a>4. 自动下载博客内容</h4><p>我希望每次博客仓库有更新的时候能自动重建本地仓库，为此我专门写了一个工具git-watcher: <a href="https://github.com/mymonkey110/git-watcher" target="_blank" rel="noopener">https://github.com/mymonkey110/git-watcher</a>。当有新的内容push到你的仓库是，它会自动拉去并重建本地仓库。基本原理就是利用github的webhook功能，当有新的push事件发生时，github会发布相应的事件到指定的接口。git-watcher监听push事件，当接受到push事件去pull仓库。如果你觉得这个工具有点儿意思，Please star it.</p>
<h5 id="4-1-安装git-watcher-amp-git"><a href="#4-1-安装git-watcher-amp-git" class="headerlink" title="4.1 安装git-watcher &amp; git"></a>4.1 安装git-watcher &amp; git</h5><p><code>pip install git-watcher</code></p>
<p><code>apt-get install git</code></p>
<h5 id="4-2-启动git-watcher"><a href="#4-2-启动git-watcher" class="headerlink" title="4.2 启动git-watcher"></a>4.2 启动git-watcher</h5><p><code>git-watcher -u https://github.com/mymonkey110/mymonkey110.github.io.git -s 654321</code></p>
<p><code>-u</code>参数配置我们的博客仓库地址</p>
<p><code>-s</code>参数是我们webhook的secret key</p>
<p>git-watcher还支持其他一些参数配置，-h见说明</p>
<h5 id="4-3-配置dns解析"><a href="#4-3-配置dns解析" class="headerlink" title="4.3 配置dns解析"></a>4.3 配置dns解析</h5><p>将默认的dns解析到我们自己的主机上</p>
<p><img src="/images/baidu_index/10.pic_hd.jpg" alt="配置解析"></p>
<h5 id="4-4-配置webhook"><a href="#4-4-配置webhook" class="headerlink" title="4.4 配置webhook"></a>4.4 配置webhook</h5><p>进入仓库的<code>settings</code> －&gt; <code>Webhooks &amp; services</code></p>
<p>设置：<code>Payload URL</code>，这里输入我们主机的地址，这里只能用ip地址。同时，还要设置Secret，这个是用来签名body内容用的，一定要与git-watcher中配置一致</p>
<p><img src="/images/baidu_index/13.pic.jpg" alt="配置Webhook"></p>
<p>注意，我们只选择发送<code>push</code>事件就可以了。</p>
<h5 id="4-5-测试"><a href="#4-5-测试" class="headerlink" title="4.5 测试"></a>4.5 测试</h5><p>我们进行一些修改，然后push到博客的仓库，检测一下网站内容是否更新。如果正常更新，那说明已经大功告成了。这是可以再用百度的抓取工具进行诊断。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>解决百度抓取github内容的问题基本思路都是让百度不直接访问Github，而是通过一个中间服务器来缓存内容。两种方式都需要付费，相对来说使用又拍云搭建镜像服务器在流量较小的情况下比较有优势，速度快，费用少；而自己租用主机在博客流量较大的时候比较经济，你可以选择按带宽计费的方式，同时你还获得了一台完全由你控制的主机，何乐而不为呢？！</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/生活/">生活</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/life-blog/">life blog</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/06/17/博客域名更新/" title="博客域名更新：michael-j.net" itemprop="url">博客域名更新：michael-j.net</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Michael Jiang" target="_blank" itemprop="author">Michael Jiang</a>
		
  <p class="article-time">
    <time datetime="2016-06-17T07:20:31.000Z" itemprop="datePublished"> Published 2016-06-17</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>由于备案原因😢，弃用老的域名michael-j.xyz,正式修改为：</p>
<p><strong><em><a href="http://michael-j.net">http://michael-j.net</a></em></strong></p>
<p>本博客主要纪录本人对技术、管理、生活的一些感悟。技术人一定要有沉淀，写博客是一个非常好的方式，我也经常鼓励团队中其他人写博客，记录自己的成长。</p>
<p>喜欢本站内容的同学可以加入收藏哦，也支持rss订阅！😊</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/生活/">生活</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/life/">life</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/06/07/Java异常的选择/" title="Java异常的选择：Checked Exception还是Unchecked Exception ?" itemprop="url">Java异常的选择：Checked Exception还是Unchecked Exception ?</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Michael Jiang" target="_blank" itemprop="author">Michael Jiang</a>
		
  <p class="article-time">
    <time datetime="2016-06-07T07:20:31.000Z" itemprop="datePublished"> Published 2016-06-07</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>曾经听到过关于老司机和新手程序员的区别，其中最大的一个区别就在于异常的处理。新手程序员总是天真得把世界想得太美好，基本上没想过会出现异常的情况，而一个经验丰富的老司机会把最坏的打算考虑进去，给出相应的解决办法，使得发生异常时对系统的影响降低到最小。对此，我深表认同。现实的情况总是复杂的，而且还有很多不怀好意的人时刻准备攻击你的系统。使用你系统的用户越多，这种潜在的风险也就越大。</p>
<p>异常处理是应对这些风险的最强有力的武器。在Java的世界里，异常有两种：受检异常(checked exception)和非受检异常（unchecked exception）。想必所有的Javaer都使用过这两种异常，但是何时使用哪个异常缺失经常困扰程序员的头疼问题。在此，我分享一下自己的看法，如果你有不同的意见，请留意探讨。</p>
<h4 id="1-如果正常情况下会出现，那么使用Checked-Exception；反之，则使用Unchecked-Exception"><a href="#1-如果正常情况下会出现，那么使用Checked-Exception；反之，则使用Unchecked-Exception" class="headerlink" title="1.如果正常情况下会出现，那么使用Checked Exception；反之，则使用Unchecked Exception"></a>1.如果正常情况下会出现，那么使用Checked Exception；反之，则使用Unchecked Exception</h4><p>这条准则是我在决定使用Checked Exception还是Unchecked Exception的第一原则。如果API的使用者在正常使用的过程中都会出现异常，那么这种异常就属于Checked Exception。因为这种异常时属于程序执行流程众多分支之一，API的使用者必须意识到这种情况，并做出相应的处理。</p>
<p>举个栗子：</p>
<p>我希望向zookeeper中创建一个节点，那么这种情况就隐含了两个前提条件：</p>
<ul>
<li>父节点已经被创建（如果有的话）</li>
<li>本节点还未被创建</li>
</ul>
<p>那么，这个API的签名大致应该是这样：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">createNode</span><span class="params">(String path,<span class="keyword">byte</span>[] data)</span> <span class="keyword">throws</span> FatherNodeNotExist, NodeExist</span>;</span><br></pre></td></tr></table></figure>
<p>API的使用者看到这个签名的定义时就会得到一个强烈的心理暗示，我需要考虑父节点不存在和本节点已存在的情况，那么他就不得不显示的去处理这两种异常。</p>
<p>有的朋友可能会争论说，我正常的情况下不会出现这种情况，因为使用这个API的前提就是先创建好父节点，而后创建本节点，那我就不用抛出两种异常了，使用者也轻松了许多。但事实真的如此吗？我们想当然的认为了使用者是<code>自己人</code>，他们会乖乖的按照我们的想法去先创建父节点，再创建本节点，如果是在一个很局限的使用场景下，每个人都说经过严格培训的，那么你可以去做这样的假设，但是我还是不推荐你这么做，因为这样设计使得系统是脆弱的，不稳定的。如果能通过系统能自己避免这些错误，为什么不呢？况且，如果你把这个API开放给第三方的使用者，那么情况会更糟糕，你根本不知道他们会怎样去使用API，这非常恐怖！</p>
<p>有时候情况会变得很复杂，<code>正常情况</code>的鉴定变得很困难，你肯定会遇到这种时候，此时就需要结合你的业务场景去权衡其中的利弊。这依赖与你的经验和对业务场景的理解，我无法给你一个绝对的建议，那样是不负责任的。</p>
<p>我再举个常见的栗子：用户修改他拥有的资源信息。在菜谱APP中给出一个接口，让用户修改他菜谱的信息。那么这里一个隐含的条件就是用户修改他自己的菜谱信息，他是无权限修改别人的菜谱信息的。那么这个API的签名可能是这样的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">updateMenu</span><span class="params">(<span class="keyword">long</span> menuId,<span class="keyword">long</span> uid,String title,String description...)</span></span>;</span><br></pre></td></tr></table></figure>
<p>如果用户尝试去修改不属于他的菜谱呢？我们是否需要throws UserPermissionException之类受检异常？我认为是不需要的。判断是这属于正常情况吗？我认为这不算是正常情况。<br>正常情况下，客户端调用修改信息的接口，那么menuId一定是属于这个用户的。如果出现这种情况，要么是你系统设计的就有问题，要么就是不怀好意的人在破坏你的系统。前者需要重新设计我们的系统，而后者我们更不用关系，直接抛出一个RuntimeException就可以，因为他不算正常用户。</p>
<h4 id="2-调用者中能从异常中恢复的，推荐使用受检异常；反之，则使用非受检异常"><a href="#2-调用者中能从异常中恢复的，推荐使用受检异常；反之，则使用非受检异常" class="headerlink" title="2. 调用者中能从异常中恢复的，推荐使用受检异常；反之，则使用非受检异常"></a>2. 调用者中能从异常中恢复的，推荐使用受检异常；反之，则使用非受检异常</h4><p>注意这里的一个关键词是<code>推荐</code>，决定使用哪种异常最为根本的还是第一条原则。如果第一条原则难以判断时，才考虑调用者。这条原则和<code>Effective Java</code>中的第58条很像，如果有这本书的朋友可以再拿出来读读。</p>
<p>我和<code>Effective Java</code>#58不同的观点在于，这条原则只能是<code>推荐</code>，另外，对于所有不能恢复的情况我都建议使用非受检异常。我对可恢复的理解是，如果API的调用者能够处理你抛出的异常，并给出积极的响应和反馈，并指导它的使用者做出调整，那么这就是可恢复的。不可恢复就是API的调用者无法处理你抛出的异常，或者仅仅只是打个LOG记录一下，不能对它的使用者做出提示，那么都可认为是不可恢复的。</p>
<p>还是最开始的栗子，如果调用<code>createNode</code>的调用者能响应<code>FatherNodeNotExist</code>，并把这种情况反应到终端上，那么使用受检异常是有积极意义的。对于不可恢复的情况，包括编程错误，我建议都是用非受检异常，这样系统能<code>fail fast</code>，把异常对系统的影响降到最低，同时你还能获得一个完整的异常堆栈信息，何乐而不为呢？！</p>
<p>基本上，这两条原则就能帮你决定到底是使用受检异常还是非受检异常了。当然，现实的情况很复杂，需要根据你所处的具体业务场景来判断，经验也是不可或缺的。在设计API的时候多问下自己这是正常情况下出现的吗，调用者可以处理这个异常吗，这会很有帮助的！</p>
<p>异常处理是一个非常大的话题，除了选择<code>checked exception</code>还是<code>unchecked exception</code>以外，还有一些一般的通用原装，例如：</p>
<ul>
<li>只抛出与自己有关的异常</li>
<li>封装底层异常</li>
<li>尽量在抛出异常的同时多携带上下文信息</li>
</ul>
<p>这些在<code>Effective Java</code>中都有详细的介绍，朋友可以认真读一下这本书，写的非常好！</p>
<p>对异常处理有不同理解的朋友可以给我留言，一起讨论，共同进步！</p>
<p>参考文献：</p>
<p><a href="https://github.com/HackathonHackers/programming-ebooks/blob/master/Java/Effective%20Java%20\(2nd%20Edition\" target="_blank" rel="noopener">Effective Java, 2nd Edition</a>.pdf)</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Java/">Java</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Java/">Java</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/04/12/防范xss的正确姿势/" title="防范xss的正确姿势" itemprop="url">防范xss的正确姿势</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Michael Jiang" target="_blank" itemprop="author">Michael Jiang</a>
		
  <p class="article-time">
    <time datetime="2016-04-12T07:20:31.000Z" itemprop="datePublished"> Published 2016-04-12</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>xss攻击是web攻击中非常常见的一种攻击手段。如果你还没有听说过xss攻击，可以先了解xss的相关知识和原理，例如:<a href="https://www.owasp.org/index.php/Cross-site_Scripting_(XSS)" target="_blank" rel="noopener">https://www.owasp.org/index.php/Cross-site_Scripting_(XSS)</a>。</p>
<p>防范xss攻击的方式也十分简单：转义！</p>
<p>但是转义的时机？是在持久化之前转义呢，还是读数据之后escape呢？</p>
<p>我开始想也没想就选择了第一种方式，因为这种方法看上去一劳永逸，但是我现在越来越倾向于第二种方式。</p>
<p>实际上选择第一种还是第二种需要根据你的实际情况来定。我们知道xss攻击是一种web攻击手段，它的运行环境是在用户的浏览器中，也就是说用户的运行环境是不可控的。那么在持久化之前进行转义看上去似乎不错，因为我们可以利用filter或者interceptor拦截所有的写入请求，统一进行转义。这样一来，我们的业务逻辑就完全不需要care转义的问题了，因为我们取到的数据已经都是转义的过的了。</p>
<p>如果用户的终端是可控的，比如：Native App，那么入库之前进行转义就显得多此一举，因为所有的输出方式都是在我们的App中展现的，自然也就不会出现了xss攻击的问题了。例如用户在评论中输入了<code>&lt;哈哈&gt;</code>，你觉得用户希望输出<code>&amp;lt;哈哈&amp;gt</code>;，还是<code>&lt;哈哈&gt;</code>呢？ 结果是显而易见的。</p>
<p>现实的情况往往是复杂的，不会只有黑和白、0与1、native和web，更多的是它们交织在一起，互相入侵对方的领域。基本上现在大部分的App都有分享功能，那么恶意的用户完全可以在评论中插入注入代码，再将该评论分享出去，那么其它被分享的用户就有被攻击的风险。解决的方法就是针对分享的数据进行全局转义，事实上已经很多模版系统已经帮我们考虑了这部分问题，例如Django和Jinja2的模版就是默认开启自动转义的。如果是前后端分离的场景，也可以有前端来进行escape。</p>
<p>我推荐使用“入库不转义读转义”还有一个原因，那就是前期转义格式的不确定性和后期输出的多样性。如果你正在正在开发一个rest服务器，你与App使用json格式通信。为了简单，在开始业务代码前，你对所有输入数据按照html格式进行转义。那么你可以十分放心分享出去的数据是安全的，因为所有的数据在持久化之前就已经转义了，同时你会痛苦unescape给App的数据。如果那天老板要求你以xml的格式输出这些数据（可能是其它系统的输入要求，也可能是打印报表），那么你会更加痛苦。因为xml和html的转义字符还是有些不同的，你不得不先unescape回原始数据然后再按照xml的格式escape一次。如果这样你觉得都还ok，那么我开始有点佩服你了。如果老板还要求你有更多的输出格式，那么你会更加痛苦，这还是在没有考虑输入格式变化的情况下。因为一个转义的问题导致逻辑变得复杂，影响系统的稳定性是得不偿失的。</p>
<p>最后，我总结一下这两种方式的优缺点：</p>
<table>
<thead>
<tr>
<th>转义方式</th>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody>
<tr>
<td>入库前转义</td>
<td>一劳永逸</td>
<td>需要针对多端进行不同的输出，灵活性不足，无法应对后期数据格式的变化</td>
</tr>
<tr>
<td>读取前转义</td>
<td>简单，灵活，能应对各种数据格式的场景</td>
<td>需要对每个输出数据转义，人工处理容易遗漏</td>
</tr>
</tbody>
</table>
<p>本人推荐第二种方式来防范xss攻击。虽然需要对每个输出数据都进行转义，但是如果你使用带自动转义的模版或者框架来处理的话，那么就可以极大的提高效率，又可以规避安全的问题。最后还是要提醒大家，安全无小事，即使你觉得没有人会攻击的系统，还是要规避这些风险，安全是系统的基石。</p>
<p>参考文献：</p>
<p><a href="https://n0tw0rthy.wordpress.com/2011/10/07/when-do-you-escape-your-data/" target="_blank" rel="noopener">Why escape-on-input is a bad idea</a></p>
<p><a href="https://n0tw0rthy.wordpress.com/2011/10/07/when-do-you-escape-your-data/" target="_blank" rel="noopener">When do you escape your data?</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/安全/">安全</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/security/">security</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/03/18/Mac下拳皇97黑屏问题的解决方法/" title="Mac下拳皇97黑屏问题的解决方法" itemprop="url">Mac下拳皇97黑屏问题的解决方法</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Michael Jiang" target="_blank" itemprop="author">Michael Jiang</a>
		
  <p class="article-time">
    <time datetime="2016-03-17T16:00:00.000Z" itemprop="datePublished"> Published 2016-03-18</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>使用Mac系统很久了，渐渐的已经依赖上了这个系统。虽然Mac OS能让我们更加关注于工作，但是偶尔我们还是希望能小小的娱乐一把。我就比较喜欢玩一些小游戏，比如<code>拳皇97</code>。</p>
<p><code>拳皇街机</code>系列满载的我们80后慢慢的回忆啊！想玩97的朋友可以去：<a href="http://www.pc6.com/mac/112306.html" target="_blank" rel="noopener">http://www.pc6.com/mac/112306.html</a>下载。</p>
<p>按照提示方法，我发现运行一直是黑屏状态，十分蛋疼。Google了一番后最终找到了解决方法：</p>
<p>打开<code>MAM</code>E的<code>Preferenc</code>e -&gt; 切换到<code>Video</code> -&gt; <code>Rendering Option</code>中的<code>Render frames using</code>切换到 <code>OpenGL</code>模式</p>
<p>重新载入游戏就大功告成啦！！！ 祝大家游戏愉快～</p>
<p>还搞不定可以参考下面这篇帖子👇：</p>
<p><a href="https://www.reddit.com/r/mac/comments/3nr2gr/mame_135_on_el_capitan_loads_black_screen_when/" target="_blank" rel="noopener">https://www.reddit.com/r/mac/comments/3nr2gr/mame_135_on_el_capitan_loads_black_screen_when/</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/生活/">生活</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/life/">life</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/01/19/实现领域事件/" title="实现领域事件" itemprop="url">实现领域事件</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Michael Jiang" target="_blank" itemprop="author">Michael Jiang</a>
		
  <p class="article-time">
    <time datetime="2016-01-19T08:53:05.000Z" itemprop="datePublished"> Published 2016-01-19</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>当你的系统或者业务变得日益复杂时，<code>DDD</code>的模式是一种非常值得尝试的架构模式。<code>DDD</code>让你更加关注于你的业务领域，思考你的业务模型，帮组你理清繁杂的业务关系。我推荐所有还没有了解过或者接触过<code>DDD</code>的后端工程师都去学习一下该架构模式。本文主要关注<code>DDD</code>中的<code>领域事件</code>，以及一种可能的实践方式。</p>
        
        
        <p class="article-more-link">
          
            <a href="/2016/01/19/实现领域事件/#more">Read More</a>
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/DDD/">DDD</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/领域事件/">领域事件</a><a href="/tags/event/">event</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/01/05/评论设计/" title="评论设计" itemprop="url">评论设计</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Michael Jiang" target="_blank" itemprop="author">Michael Jiang</a>
		
  <p class="article-time">
    <time datetime="2016-01-05T09:52:07.000Z" itemprop="datePublished"> Published 2016-01-05</time>
    
  </p>
</header>
    <div class="article-content">
        
        <blockquote>
<p>本文主要分享了我在设计评论模块中的一些心得，希望对读者有些许帮助。</p>
</blockquote>
<h3 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h3><p>现阶段评论做的最好的我想应该是<code>网易新闻</code>（app）里面的评论模块了，其“盖楼”的方式让人印象深刻，评论已经成为该app的核心功能之一了。市面上大部分app的评论模块设计的还是相对简单的，这是可以理解的，因为评论模块不是这些app的核心功能之一。</p>
<p>在设计评论模块前可以和pd或者boss沟通，我们的评论功能是核心功能之一吗？实际上，90%的app采用简单的评论设计就可以了，也就是采用<code>一问一答</code>，类似于如下的设计。</p>
<p><img src="http://7xnwpq.com1.z0.glb.clouddn.com/2.pic.jpg?imageView/2/w/480/h/640|watermark/2/text/aHR0cDovL21pY2hhZWwtai54eXo=" alt="一问一答"></p>
<p>这种设计十分简单、直接，也满足了用户评论、回复的基本要求，对于没有大量用户评论或者评论不是核心功能的app来说就够用了。暂且把这种场景称之为<code>场景A</code>。</p>
<p>如果你是新闻类或者咨询类的app，有着大量的用户评论，那么设计“盖楼”的效果还是可取的，这样能帮助用户找到该条评论或者回复的上下文情景。但是根据“盖楼”的显示效果不同，设计上也是有很大的差别的。如果是以<code>评论为主</code>的显示方式，类似于下面的显示方式。</p>
<p><img src="http://7xnwpq.com1.z0.glb.clouddn.com/3.pic.jpg?imageView/2/w/500/h/800|watermark/2/text/aHR0cDovL21pY2hhZWwtai54eXo=" alt="评论为主"></p>
<p>这里可以把评论分为<code>评论</code>和<code>回复</code>，所有的<code>回复</code>均挂在<code>评论</code>下面，类似于树状结构。把这种场景称之为<code>场景B</code></p>
<p>最后就是类似于网易新闻的评论设计了，贴一张截图</p>
<p><img src="http://7xnwpq.com1.z0.glb.clouddn.com/5.pic.jpg?imageView/2/w/400/h/600|watermark/2/text/aHR0cDovL21pY2hhZWwtai54eXo=" alt="同级显示"></p>
<p>这种场景下设计最为复杂，因为回复和评论是同等级的，回复还可以引用完整的回复路径，就是可以溯源到最开始的评论上。这种场景我将至称为<code>场景C</code>。</p>
<h3 id="数据库设计"><a href="#数据库设计" class="headerlink" title="数据库设计"></a>数据库设计</h3><p>由于我 一直使用<code>mysql</code>，我就以<code>mysql</code>为例谈一下针对上面三种场景的设计。</p>
<h4 id="场景A"><a href="#场景A" class="headerlink" title="场景A"></a>场景A</h4><p>这种场景下一般评论数量较少，评论不为活跃，可以把不区分评论和回复，而统一看成评论。区别在于有的评论是直接评论<code>主题</code>(每个评论都挂在某个主题下，如文章、帖子等)，而有些评论是<code>@</code>其他用户的，为了能cover这两张场景，使用一张表就可以达到效果，评论表如下设计：</p>
<table>
<thead>
<tr>
<th>表字段</th>
<th>字段说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>主键</td>
</tr>
<tr>
<td>topic_id</td>
<td>主题ID</td>
</tr>
<tr>
<td>topic_type</td>
<td>主题type</td>
</tr>
<tr>
<td>content</td>
<td>评论内容</td>
</tr>
<tr>
<td>from_uid</td>
<td>评论用户id</td>
</tr>
<tr>
<td>to_uid</td>
<td>评论目标用户id</td>
</tr>
</tbody>
</table>
<p>为了能复用评论模块，我们引入一个<code>topic_type</code>字段来区分主题的类别。</p>
<p><code>from_uid</code>表示评论人的id，通过该id我们可以检索到评论人的相关信息。</p>
<p><code>to_uid</code> 是评论目标人的id，如果没有目标人，则该字段为空。</p>
<p>出于性能的考虑，往往我们会冗余评人的相关信息到评论表中，比如评论人的nick、头像等，目标用户也是如此。这样一来我们就只用查询单表就可以达到显示的效果。</p>
<p>有时，目标用户有多个，那么可以将<code>to_uid</code>字段修改为<code>to_uids</code>，保存时用分隔符来分割用户id，而目标用户的信息再去查询缓存或者数据库。也可以简单的将多个目标用户的信息一起存成json格式，可以应付简单的展现需求。</p>
<h4 id="场景B"><a href="#场景B" class="headerlink" title="场景B"></a>场景B</h4><p>在以评论为主的树形显示的情况下，数据库的设计十分灵活，可以使用单表，添加一个<code>parent_id</code>字段来指向父评论。如果数据库本身支持嵌套查询，那么还是比较方便的，SqlServer、Oracle都支持，但是mysql不支持，那就只能通过存储过程来实现。在互联网应用中，能不使用<code>触发器</code> ｀存储过程`的话，尽量不要去使用，因为其对性能有影响。</p>
<p>我们还可以将评论拆分为<code>评论表</code> 和 <code>回复表</code>，<code>评论</code>挂在各种<code>主题</code>下面，而<code>回复</code>都挂在<code>评论</code>下面。</p>
<p><code>评论表</code>的设计如下：</p>
<table>
<thead>
<tr>
<th>表字段</th>
<th>字段说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>主键</td>
</tr>
<tr>
<td>topic_id</td>
<td>主题ID</td>
</tr>
<tr>
<td>topic_type</td>
<td>主题type</td>
</tr>
<tr>
<td>content</td>
<td>评论内容</td>
</tr>
<tr>
<td>from_uid</td>
<td>评论用户id</td>
</tr>
</tbody>
</table>
<p><code>回复表</code>的设计如下：</p>
<table>
<thead>
<tr>
<th>表字段</th>
<th>字段说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>主键</td>
</tr>
<tr>
<td>comment_id</td>
<td>评论ID</td>
</tr>
<tr>
<td>reply_id</td>
<td>回复目标id</td>
</tr>
<tr>
<td>reply_type</td>
<td>回复类型</td>
</tr>
<tr>
<td>content</td>
<td>回复内容</td>
</tr>
<tr>
<td>from_uid</td>
<td>回复用户id</td>
</tr>
<tr>
<td>to_uid</td>
<td>目标用户id</td>
</tr>
</tbody>
</table>
<p>由于我们拆分了评论和回复，那么评论表就不再需要目标用户字段了，因为评论均是用户对主题的评论，评论表的设计更佳简洁了。</p>
<p>回复表我添加了一个<code>comment_id</code>字段来表示该回复挂在的根评论id，这样设计也是出于性能方面的考虑，我们可以直接通过评论id一次性的捞出该评论下的所有回复，然后通过程序来编排回复的显示结构。通过适当的冗余来提高性能也是常用的优化手段之一。这里给出一段我通过来评论id来查找并组织所有回复的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">public List&lt;ReplyDTO&gt; getReplyListByRid(Long rid) &#123;</span><br><span class="line">List&lt;ReplyDO&gt; replyDOList = replyDAO.queryReplyByCid(rid);</span><br><span class="line">        if (replyDOList == null || replyDOList.size() == 0) &#123;</span><br><span class="line">            return new ArrayList&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        List&lt;ReplyDTO&gt; replyDTOList = new ArrayList&lt;&gt;();</span><br><span class="line">        List&lt;ReplyDTO&gt; parentList = new ArrayList&lt;&gt;();</span><br><span class="line">        for (ReplyDO replyDO : replyDOList) &#123;</span><br><span class="line">            ReplyDTO replyDTO = convertReplyToDTO(replyDO);</span><br><span class="line">            if (replyDTO.getReplyType() == ReplyType.COMMENT) &#123;</span><br><span class="line">                replyDTOList.add(replyDTO);</span><br><span class="line">                parentList.add(replyDTO);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                boolean foundParent = false;</span><br><span class="line">                if (replyDTOList.size() &gt; 0) &#123;</span><br><span class="line">                    for (ReplyDTO parent : parentList) &#123;</span><br><span class="line">                        if (parent.getId().equals(replyDTO.getReplyId())) &#123;</span><br><span class="line">                            if (parent.getNext() == null) &#123;</span><br><span class="line">                                parent.setNext(new ArrayList&lt;ReplyDTO&gt;());</span><br><span class="line">                            &#125;</span><br><span class="line">                            parent.getNext().add(replyDTO);</span><br><span class="line">                            parentList.add(replyDTO);</span><br><span class="line">                            foundParent = true;</span><br><span class="line">                            break;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                if (!foundParent) &#123;</span><br><span class="line">                    throw new RuntimeException(&quot;sort reply error,should not go here.&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return replyDTOList;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p><code>reply_type</code>表示回复的类型，因为回复可以是针对评论的回复(comment)，也可以是针对回复的回复(reply)， 通过这个字段来区分两种情景。</p>
<p><code>reply_id</code>表示回复目标的id，如果reply_type是comment的话，那么reply_id＝commit_id，如果reply_type是reply的话，这表示这条回复的父回复。</p>
<p>在数据结构的设计上，我在replyDTO中设计了一个<code>List&lt;ReplyDTO&gt; next</code>属性，这样在形成了一个树形的结构，类似如下结构。</p>
<p><img src="http://7xnwpq.com1.z0.glb.clouddn.com/6.pic.jpg?imageView/2/w/300/h/600|watermark/2/text/aHR0cDovL21pY2hhZWwtai54eXo=" alt="树形结构"></p>
<p>客户端可以直接根据该结构来进行树形结构的显示。</p>
<h4 id="场景c"><a href="#场景c" class="headerlink" title="场景c"></a>场景c</h4><p>要达到网易新闻中评论的效果我还没有特别好的建议。这种场景中评论和回复是同级显示的，回复不在显示结构上不用挂在一个评论下面。双表的设计在这里就不太合适了，因为涉及到评论和回复的混排，使用双表则会导致查询的逻辑过于复杂。所以建议还是采用单表的设计，不区分评论和回复会简化应用层的逻辑。我们统一都看成评论，而有些评论是可以引用其他评论的。本人推荐采用闭包表的设计，例如：</p>
<p>comment表设计</p>
<table>
<thead>
<tr>
<th>表字段</th>
<th>字段说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>主键</td>
</tr>
<tr>
<td>topic_id</td>
<td>主题ID</td>
</tr>
<tr>
<td>topic_type</td>
<td>主题type</td>
</tr>
<tr>
<td>content</td>
<td>评论内容</td>
</tr>
<tr>
<td>from_uid</td>
<td>评论用户id</td>
</tr>
</tbody>
</table>
<p>parent_children表</p>
<table>
<thead>
<tr>
<th>表字段</th>
<th>字段说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>主键</td>
</tr>
<tr>
<td>parent_id</td>
<td>父id</td>
</tr>
<tr>
<td>child_id</td>
<td>子id</td>
</tr>
</tbody>
</table>
<p>comment表保存所有评论内容，而parent_children表则记录评论表中各个评论的父子关系。</p>
<p>查询时往往会按照时间排序，我们可以直接按id或者创建时间降序排列查询comment表即可。如果用户想查询一条评论的完整引用，则可以通过parent_children来找到对应的路径。向上查找到评论只需要可执行：</p>
<blockquote>
<p>select parent_id from parent_children where child_id=${id} and parent_id != ${id}</p>
</blockquote>
<p>向下查找所有的子孙评论可执行：</p>
<blockquote>
<p>select child_id from parent_children where parent_id = ${id} and parent_id != ${id}</p>
</blockquote>
<p>闭包表在查询时非常方便，但是插入的性能稍差，因为除了插入评论表以外，还需要把该条评论所有的父子关系插入到父子关系表中。插入性能会随着评论层级的加深而线性下降。</p>
<h3 id="海量数据优化"><a href="#海量数据优化" class="headerlink" title="海量数据优化"></a>海量数据优化</h3><p>如果你的系统每天都会有成千上万条评论，那么单表的设计肯定是不行，优化的方式也有很多。</p>
<ul>
<li><p>分库分表。分库分表是最为常用也最有效的优化方式，建议按照主题来分库分表。这样同一个主题下面的评论就会落到同一张表里，避免了跨表查询。</p>
</li>
<li><p>适当的数据冗余。如果你需要显示评论人的相关信息，那么在插入评论时就把这些信息写入评论表中，避免多次查询。实际上，如果是纪录数据，都可以冗余对应的数据信息，因为它们的数据的实时行和一致性要求并不高，用户不会因为评论中的头像没更新而撕了你，哈哈。</p>
</li>
<li><p>附加幂等数据只允许单项操作。如果pd要求你能给评论点赞，那么你可以告诉他只能点赞，不能取消。因为从幂等性的要求来说，每个赞都是一条记录。评论的赞数如果都从点赞表中统计得出，那么性能开销会十分巨大，而且点赞如此轻量级的一个操作一定会加剧点赞表的竞争操作。所以建议直接在评论表中添加一个<code>like_count</code>的计数器，该字段只增不减。</p>
</li>
<li><p>热门评论加缓存。类似于网易新闻的热门评论，读取频度非常高，可以专门开接口给客户端，同时该接口做缓存。</p>
</li>
</ul>
<p>参考文献：</p>
<p><a href="http://blog.csdn.net/tiantiandjava/article/details/45390859" target="_blank" rel="noopener">逻辑数据库设计 - 单纯的树(递归关系数据)</a></p>
<p><a href="http://qinxuye.me/article/storing-hierachical-data-in-database/" target="_blank" rel="noopener">在数据库中存储层级结构</a></p>
<p><a href="http://stackoverflow.com/questions/4048151/what-are-the-options-for-storing-hierarchical-data-in-a-relational-database" target="_blank" rel="noopener">What are the Options for Storing Hierarchical Data in a Relational Database</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/架构设计/">架构设计</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/架构/">架构</a><a href="/tags/评论系统/">评论系统</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/10/30/Tomcat deploy twice/" title="Debug:Tomcat deploy twice" itemprop="url">Debug:Tomcat deploy twice</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Michael Jiang" target="_blank" itemprop="author">Michael Jiang</a>
		
  <p class="article-time">
    <time datetime="2015-10-30T02:46:31.000Z" itemprop="datePublished"> Published 2015-10-30</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>最近写了一个分布式时间调度系统，用于调度集群类的定时任务程序。架构如下：</p>
<p><img src="http://7xnwpq.com1.z0.glb.clouddn.com/jscheduler.png" alt=""></p>
<p>有一个集中化的Scheduler来调度集群中所有的job,集群中的job只负责实现具体job内容，而Trigger的定义和管理均在Scheduler中实现。Trigger通过MQ将触发消息发送到集群中的某台机器上。</p>
<p>在部署Scheduler的过程中观察日志如下出现以下奇怪的现象：</p>
<p><img src="http://7xnwpq.com1.z0.glb.clouddn.com/E77611B1-937A-49AD-B51D-797143F9B6B1.png" alt="debug-1"></p>
<p>我们发现在同一时刻Scheduler对一个Job触发了两次，而在集群的某台机器上发现一个Job被触发了4次：</p>
<p><img src="http://7xnwpq.com1.z0.glb.clouddn.com/9CDEE719-9454-4E4B-99C3-684518E9F49F.png" alt="debug-2"></p>
<p>当我在自己的机器上始终无法复现该问题。由于是同一个war包，故排出了代码的问题。不同之处在于，我本机启动的方式是用jetty的插件直接启动的，而服务器上则是用的是tomcat容器。经过一番排查发现，是tomcat重复部署的问题，tomcat的<a href="https://tomcat.apache.org/tomcat-7.0-doc/deployer-howto.html" target="_blank" rel="noopener">官方文档</a>有如下说明:</p>
<blockquote>
<p>Any Context Descriptors will be deployed first.</p>
</blockquote>
<p>因为我想讲应用直接部署在/下，所以在server.xml中的localhost节点下加入了context的配置。根据tomcat的官方文档，如果host下面有context的配置则会先部署，而后容器再部署一次。也就是说，应用被部署了两次。这也就解释了为什么scheduler会触发两次，而job会触发4次了。</p>
<p>解决的方法是将<code>deployOnStart</code>设置为<code>false</code>，<code>autoDeploy</code>设置为<code>false</code>。</p>
<p>参考：</p>
<p><a href="http://stackoverflow.com/questions/7223108/quartz-job-runs-twice-when-deployed-on-tomcat-6-ubuntu-10-04lts" target="_blank" rel="noopener">http://stackoverflow.com/questions/7223108/quartz-job-runs-twice-when-deployed-on-tomcat-6-ubuntu-10-04lts</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/踩过的那些坑/">踩过的那些坑</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/debug/">debug</a><a href="/tags/tomcat/">tomcat</a><a href="/tags/部署/">部署</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <a class="extend prev" rel="prev" href="/page/2/"><span></span>Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/4/">Next<span></span></a>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  


  
<div class="categorieslist">
	<p class="asidetitle">Categories</p>
		<ul>
		
		  
			<li><a href="/categories/Better-code/" title="Better code">Better code<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/C/" title="C#">C#<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/DDD/" title="DDD">DDD<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/Java/" title="Java">Java<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/debug/" title="debug">debug<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/云计算/" title="云计算">云计算<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/安全/" title="安全">安全<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/架构设计/" title="架构设计">架构设计<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/生活/" title="生活">生活<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/编程心智/" title="编程心智">编程心智<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/编程感悟/" title="编程感悟">编程感悟<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/网络/" title="网络">网络<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/翻译/" title="翻译">翻译<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/踩过的那些坑/" title="踩过的那些坑">踩过的那些坑<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/部署/" title="部署">部署<sup>1</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/DDD/" title="DDD">DDD<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/cloud/" title="cloud">cloud<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/云计算/" title="云计算">云计算<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/debug/" title="debug">debug<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/架构设计/" title="架构设计">架构设计<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/架构/" title="架构">架构<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/领域事件/" title="领域事件">领域事件<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/event/" title="event">event<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/life/" title="life">life<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/访问控制/" title="访问控制">访问控制<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/DSL/" title="DSL">DSL<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/系统架构/" title="系统架构">系统架构<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/代码架构/" title="代码架构">代码架构<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/编程心得/" title="编程心得">编程心得<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/计费/" title="计费">计费<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/CQRS/" title="CQRS">CQRS<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/C-tcp-udp-network/" title="C# tcp udp network">C# tcp udp network<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/感悟/" title="感悟">感悟<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/btrace/" title="btrace">btrace<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Java/" title="Java">Java<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
          <li>
            
            	<a href="https://coderq.com" target="_blank" title="一个面向程序员交流分享的新一代社区">码农圈</a>
            
          </li>
        
          <li>
            
            	<a href="http://wuchong.me" target="_blank" title="Jark&#39;s Blog">Jark&#39;s Blog</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">Weibo</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=null&verifier=b3593ceb&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Larry Page in Google. <br/>
			This is my blog,believe it or not.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/2176287895" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2020 
		
		<a href="/about" target="_blank" title="Michael Jiang">Michael Jiang</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>












<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
